<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Scene - Engine</title>
    <link href="../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">
    <link href="../css/custom.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/bootstrap-3.3.7.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Architecture", url: "#_top", children: [
          ]},
          {title: "Scene hierarchical update", url: "#scene-hierarchical-update", children: [
          ]},
          {title: "Component allocation", url: "#component-allocation", children: [
          ]},
          {title: "Component deallocation events", url: "#component-deallocation-events", children: [
          ]},
        ];

    </script>
    <script src="../js/base.js"></script>
      <script src="../js/custom.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../scene_middleware/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../scene_middleware/" class="btn btn-xs btn-link">
        Scene Middleware
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../asset_database/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../asset_database/" class="btn btn-xs btn-link">
        AssetDatabase
      </a>
    </div>
    
  </div>

    

    <p>A node hierarchy where every node can have components.</p>
<p>The node hierarchy allows positioning points in 3D space where parent movement influence the child position. <br/>
Components are functionality attached to the node that communicate with internal systems via the scene middleware.</p>
<h1 id="architecture">Architecture</h1>
<p><svg-inline src="scene_architecture.svg"></svg-inline></p>
<ul>
<li>Node: a point in 3D space.</li>
<li>SceneTree: the hierarchical view of nodes. All node movement must be done through the SceneTree.</li>
<li>Component: a component is a typed external object associated to a node.</li>
<li>Scene: an object that link nodes to components. It acts as an interface of the scene tree.</li>
</ul>
<p><svg-inline src="scene_model.svg"></svg-inline></p>
<h1 id="scene-hierarchical-update">Scene hierarchical update</h1>
<p>The node is composed of a local transform (position, rotation, scale) and a local to world matrix. <br/>
When updating a node transform, what we change is the local transform. The local to world matrix is recalculated on the fly, only when needed. The local to world matrix value is cached until the transform change again.</p>
<p>Because nodes are organized in a tree, the parent movement affect the child position. When a node parent position is set, this change is propagated recursively into the tree. This propagation is done instantaneously.</p>
<p>When a node transform has changed, the internal state of the node indicates that this frame, the node has changed. This state can be used by middleware to check if a node has moved or not.</p>
<blockquote>
<p><strong>WARNING:</strong> The state of the node is cleared every frame.</p>
</blockquote>
<h1 id="component-allocation">Component allocation</h1>
<p>The component is a structure that contains a type and an external object token.</p>
<p>When we want to add a component to a node, it's external resource has already been allocated by the scene middleware (or at least, a token has been generated). So, we provide this token to the node component allocation.</p>
<p><svg-inline src="scene_component_allocation.svg"></svg-inline></p>
<h1 id="component-deallocation-events">Component deallocation events</h1>
<p>Because component deallocation can be triggered manually by the user logic on indirectly by removing a node, component deallocation events are stored to an event buffer.</p>
<p>From the point of view of the scene, we have no idea of what is the external component object allocated or what is its purpose. So we need to send notifications when the component is removed.
To do so, the component deallocation event buffer can be consumed to execute functions accordingly to the component type.</p>
<blockquote>
<p><strong>WARNING</strong>: The component deallocation event buffer is cleared at the end of every frame. If events are not consumed before that, then events will be lost.</p>
</blockquote>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../scene_middleware/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../scene_middleware/" class="btn btn-xs btn-link">
        Scene Middleware
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../asset_database/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../asset_database/" class="btn btn-xs btn-link">
        AssetDatabase
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>