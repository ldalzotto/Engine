<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>AssetDatabase - From Scratch</title>
    <link href="../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../css/highlight.css">
    <link href="../css/custom.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../js/jquery-3.2.1.min.js"></script>
    <script src="../js/bootstrap-3.3.7.min.js"></script>
    <script src="../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Asset database", url: "#_top", children: [
              {title: "Engine assets", url: "#engine-assets" },
              {title: "Engine asset dependencies", url: "#engine-asset-dependencies" },
              {title: "Engine asset metadata", url: "#engine-asset-metadata" },
          ]},
          {title: "Asset compilation", url: "#asset-compilation", children: [
          ]},
        ];

    </script>
    <script src="../js/base.js"></script>
      <script src="../js/custom.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../scene/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../scene/" class="btn btn-xs btn-link">
        Scene
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../render_ressource/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../render_ressource/" class="btn btn-xs btn-link">
        Render ressource
      </a>
    </div>
    
  </div>

    

    <h1 id="asset-database">Asset database</h1>
<p>The asset database is a database that stores :</p>
<ol>
<li>Engine assets as blob from human-readable format</li>
<li>Engine assets dependencies</li>
<li>Engine assets file metadata (compilation only, never requested by the engine)</li>
</ol>
<p><svg-inline src="asset_database_architecture.svg"></svg-inline></p>
<p>All assets are identified by a unique ID that is the hash code of the local path of the asset file. <br/></p>
<p>For example, if we specify at database compilation time that the asset root is "E:/document/project/assets/" then an asset file located at "E:/document/project/assets/model/test.obj" will be stored and requested by using "model/test.obj" as input for hash calculation.</p>
<p>Hashes are calculated by using the djp2 function (<a href="http://www.cse.yorku.ca/~oz/hash.html">hash</a>).</p>
<h2 id="engine-assets">Engine assets</h2>
<p>Engine assets are stored as a blob chunk. The goal of the database is to provide an object format that needs the least amount of calculation for the engine to interpret it. <br/>
So assets files are transformed from a human-readable format (or commonly used file extensions like .png, .obj) to one that is close to the engine object.</p>
<p>For example, if we want to store an array of integers, the json array :</p>
<pre><code class="language-json">{
    &quot;array&quot;:[0,1,2,3,4,5]
}
</code></pre>
<p>will be compiled to it's packed memory representation :</p>
<pre><code>[size] (size_t 8 bytes)
[0] (int 4 bytes)
[1] (int 4 bytes)
[2] (int 4 bytes)
[3] (int 4 bytes)
[4] (int 4 bytes)
</code></pre>
<p>All custom defined asset files are written in json. The first field of every json file must be the type of the asset file. <br/>
For example, if we define a material, the json file will start with :</p>
<pre><code class="language-json">{
    &quot;type&quot;: &quot;MATERIAL&quot;,
    ...
}
</code></pre>
<h2 id="engine-asset-dependencies">Engine asset dependencies</h2>
<p>Asset dependencies are used to indicate all assets that are mentioned by the current asset. The system of compilation to blob is exactly the same as assets. The difference is that we are compiling the asset to provide a list of dependant asset ids.</p>
<p>Asset dependencies can be recursively evaluated, it is up to the asset compilation implementation to decide it. Again, the goal is to be the most efficient possible when dependencies are read by the engine.</p>
<p>The assets dependencies have their own table because :</p>
<ol>
<li>We don't always request them, because we have already requested an asset dependency that may have been evaluated recursively.</li>
<li>In the future, we can have a case where we want to request dependencies in different format for the same asset.</li>
</ol>
<h2 id="engine-asset-metadata">Engine asset metadata</h2>
<p>Asset metadata are all data that are irrelevant to the engine and only used or updated by tools.</p>
<h1 id="asset-compilation">Asset compilation</h1>
<p>The asset compilation is the program executed to transform human-readable assets to engine assets. <br/></p>
<p>The program takes an asset configuration json file that lists all assets that are going to be compiled. <br/>
All asset path are relative to the asset folder root.</p>
<p>The asset compilation configuration can be used to compile multiple asset databases. This is useful when writing test cases for example.</p>
<p>The configuration file has a "common" section that is used to compile asset that are required for the engine to startup. The required assets will be compiled for all database.</p>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../scene/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../scene/" class="btn btn-xs btn-link">
        Scene
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../render_ressource/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../render_ressource/" class="btn btn-xs btn-link">
        Render ressource
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>